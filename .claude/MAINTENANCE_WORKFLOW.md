# Claude Code 维护工作流

> Grayscale 项目 Claude Code 标准维护流程
> 最后更新：2026-01-11

---

## 🚀 新对话标准启动流程

每次打开新对话，Claude Code 必须执行以下步骤：

### 第一步：读取核心文档

请依次读取以下文档：

1. `.claude/README.md` - 快速参考指南
2. `.claude/PROJECT_CONTEXT.md` - 了解项目全貌
3. `.claude/CHANGELOG.md` - 查看最近3条变更

### 第二步：根据任务类型读取专项文档

| 任务类型 | 必读文档 | 选读文档 |
|---------|---------|---------|
| Bug 修复 | TROUBLESHOOTING.md | ARCHITECTURE.md |
| 新功能开发 | ARCHITECTURE.md<br>CODING_STANDARDS.md | PROJECT_CONTEXT.md |
| 性能优化 | ARCHITECTURE.md | CODING_STANDARDS.md |
| UI 调整 | CODING_STANDARDS.md（设计部分） | DESIGN_SYSTEM_PROGRESS.md |
| AI 调用优化 | ARCHITECTURE.md（AI 章节） | callAIModel.ts 源码 |

### 第三步：确认理解

在开始工作前，简要确认：
- 项目当前状态
- 相关技术约束
- 需要遵循的规范

---

## 🐛 Bug 修复标准流程

### 步骤 1：问题诊断

1. 在 TROUBLESHOOTING.md 搜索类似问题
2. 如果找到已知解决方案，直接应用
3. 如果是新问题，创建诊断计划

### 步骤 2：根因分析

诊断框架：

```
症状：[具体表现]
影响范围：[哪些功能受影响]
可能原因：[列出假设]
验证方法：[如何验证每个假设]
```

### 步骤 3：修复实施

1. 选择最小影响的修复方案
2. 修改代码
3. 验证修复效果
4. 检查是否引入新问题

### 步骤 4：文档更新

- [ ] 在 TROUBLESHOOTING.md 添加新问题和解决方案
- [ ] 在 CHANGELOG.md 记录修复内容
- [ ] 如果修改了架构，更新 ARCHITECTURE.md

---

## ✨ 新功能开发标准流程

### 步骤 1：需求理解

1. 明确功能目标
2. 识别影响的模块
3. 评估与现有架构的契合度

### 步骤 2：设计方案

参考 ARCHITECTURE.md 确定：
- [ ] 前端组件位置（哪个文件夹）
- [ ] 后端云函数需求（是否需要新建）
- [ ] API 调用方式（使用 @base44/sdk）
- [ ] 状态管理方式（是否用 useChatState.js）

### 步骤 3：编码实现

严格遵循 CODING_STANDARDS.md：
- [ ] 命名规范
- [ ] 文件大小限制（< 1000 行）
- [ ] 错误处理
- [ ] UI 一致性（使用 shadcn/ui）

### 步骤 4：测试验证

- [ ] 功能正常工作
- [ ] 没有破坏现有功能
- [ ] 暗色模式显示正常
- [ ] 性能无劣化

### 步骤 5：文档更新

- [ ] CHANGELOG.md 记录新功能
- [ ] ARCHITECTURE.md 更新架构（如果需要）
- [ ] PROJECT_CONTEXT.md 更新功能列表

---

## 🎨 UI 调整标准流程

### 必查文档

1. `DESIGN_SYSTEM_PROGRESS.md` - 了解设计系统现状
2. `CODING_STANDARDS.md` - UI 一致性规则

### 实施检查清单

- [ ] 使用 shadcn/ui 组件（不自己写基础组件）
- [ ] 使用 CSS Variables（不硬编码颜色）
- [ ] 测试暗色和亮色模式
- [ ] 确保响应式设计

---

## 🤖 AI 功能调整流程

### 核心文件理解

在修改 AI 相关功能前，必须理解：
- **callAIModel.ts** (27,164行) - 模型调用核心
- **smartChatWithSearch.ts** (31,478行) - 智能搜索集成
- **useChatState.js** (22,855行) - 状态管理

### 常见任务

| 任务 | 修改文件 | 注意事项 |
|------|---------|---------|
| 调整模型选择逻辑 | callAIModel.ts | 必须考虑成本和性能平衡 |
| 修改 Token 预算 | callAIModel.ts | 避免过度限制影响回答质量 |
| 优化上下文管理 | useChatState.js | 确保历史正确传递 |
| 添加搜索功能 | smartChatWithSearch.ts | 理解现有搜索逻辑 |

---

## 📊 代码审查检查清单

### 提交前必查

- [ ] 代码符合 CODING_STANDARDS.md 规范
- [ ] 文件大小合理（< 1000 行，AdminAnnouncements.jsx 除外）
- [ ] 包含必要的错误处理
- [ ] 没有硬编码的配置
- [ ] AI 调用已记录 Token 使用
- [ ] 更新了 CHANGELOG.md

### 性能检查

- [ ] 没有引入不必要的依赖
- [ ] 使用了代码分割（如果是大组件）
- [ ] 图片已优化
- [ ] 没有阻塞渲染的操作

### UI 检查

- [ ] 暗色模式显示正常
- [ ] 使用了统一的 UI 组件
- [ ] 响应式设计正常
- [ ] 没有硬编码的颜色值

---

## 💾 变更记录规范

### CHANGELOG.md 格式

```markdown
## YYYY-MM-DD

### 修复 🐛
- ✅ [具体问题] - [简短说明]

### 新功能 ✨
- ✅ [功能名称] - [功能描述]

### 优化 ⚡
- ✅ [优化项] - [效果说明]

### 进行中 🔄
- 🔄 [任务名称] - [当前进度]

### 技术债务 ⚠️
- ⚠️ [问题描述] - [计划处理方式]
```

---

## 🆘 遇到问题时

### 不确定如何处理时

1. 查看相关文档寻找类似案例
2. 分析现有代码的处理方式
3. 选择最符合项目规范的方案
4. 在 CHANGELOG.md 记录决策理由

### 发现文档过时时

1. 先完成当前任务
2. 在 CHANGELOG.md 记录文档需要更新
3. 在下次对话时更新文档

### 发现严重问题时

1. 立即在 TROUBLESHOOTING.md 记录
2. 在 CHANGELOG.md 标记为"紧急"
3. 提供临时解决方案（如果有）
4. 建议优先级处理

---

## 🎯 质量保证原则

1. **代码质量优于速度** - 宁可慢一点，也要写规范的代码
2. **文档同步更新** - 代码变更必须同步更新文档
3. **保持架构一致** - 新代码必须符合现有架构
4. **用户体验优先** - 功能正确性 > 代码优雅性
5. **成本意识** - AI 调用必须考虑 Token 成本

---

## 📈 持续改进

### 每周回顾

- 检查 CHANGELOG.md 本周变更
- 评估是否有新的技术债务
- 更新 TROUBLESHOOTING.md（如有新问题）

### 每月审查

- 审查所有文档的时效性
- 评估架构是否需要调整
- 分析性能和成本趋势

### 季度规划

- 制定重大重构计划
- 评估技术栈更新需求
- 规划新功能路线图

---

*本文件由 Claude Code 自动生成，如有更新请同步维护*
